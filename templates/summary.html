{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrapped Summary</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'main.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Centered Slideshow Playlist Style */
        .main-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100%;
            overflow: hidden; /* Prevent content overflow */
            background-color: #A5CBC3;
        }

        body.dark-mode .main-content {
            background-color: var(--dark-background);
            box-shadow: none;
        }

        .slideshow-container {
            position: relative;
            width: 70%;
            max-width: 1200px; /* Ensure a maximum width */
            height: 80%;
            max-height: 800px; /* Limit the max height */
            text-align: left;
            border-radius: 10px;
            margin-bottom: 20px;
            box-sizing: border-box; /* Include padding in width/height calculations */
            padding: 20px; /* Add padding to the container for spacing */
        }

        .slide {
            position: absolute;
            display: none; /* Hide the slide initially */
            padding: 20px;
            width: 100%;
            height: 100%;
            max-width: 100%; /* Prevent overflow */
            max-height: 100%; /* Prevent overflow */
            border-radius: 10px;
            text-align: left;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            background: var(--light-background);
            box-sizing: border-box; /* Ensure padding is inside the slide area */
            overflow: hidden; /* Prevent content from overflowing */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        @media (max-width: 768px) {
            .slideshow-container {
                height: 60%; /* Adjust height for smaller screens */
            }
            .slide {
                padding: 10px; /* Reduce padding for smaller screens */
            }
        }

        @media (max-width: 480px) {
            .slideshow-container {
                height: 50%; /* Further reduce height for very small screens */
            }
            .slide {
                padding: 5px; /* Further reduce padding for very small screens */
            }
        }

        .slide.active {
            display: block;
        }
        .slide img {
            max-width: 50%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* Adjusted styles for slide content */
        .slide h2 {
            font-family: 'DM Sans', sans-serif;
            color: #1E1E1E;
            font-size: 5vw; /* Adjust font size for better scaling */
            line-height: 1.1;
            margin-top: 2vw; /* Reduced margin for better fit */
            margin-left: 3vw; /* Reduced margin for better fit */
            margin-right: 3vw; /* Reduced margin for better fit */
        }

        .slide h3 {
            font-family: 'DM Sans', sans-serif;
            color: #3F665E;
            font-size: 4vw; /* Adjust font size for better scaling */
            line-height: 1.1;
            margin-top: 2vw; /* Reduced margin for better fit */
            margin-left: 3vw; /* Reduced margin for better fit */
            margin-right: 3vw; /* Reduced margin for better fit */
        }

        .slide h4 {
            font-family: 'DM Sans', sans-serif;
            color: #3F665E;
            font-size: 3.5vw; /* Adjust font size for better scaling */
            line-height: 0.9; /* Adjusted line-height for better readability */
            margin-top: 2vw; /* Reduced margin for better fit */
            margin-left: 3vw; /* Reduced margin for better fit */
            margin-right: 3vw; /* Reduced margin for better fit */
        }

        .slide h5 {
            font-family: 'DM Sans', sans-serif;
            color: #3F665E;
            font-size: 3.5vw; /* Adjust font size for better scaling */
            line-height: 0.9; /* Adjusted line-height for better readability */
            margin-top: 2vw; /* Reduced margin for better fit */
            margin-right: 3vw; /* Reduced margin for better fit */
        }

        .slide h6 {
            font-family: 'DM Sans', sans-serif;
            color: #3F665E;
            font-size: 4vw; /* Adjust font size for better scaling */
            line-height: 1.1;
            margin-left: 3vw; /* Reduced margin for better fit */
            margin-right: 3vw; /* Reduced margin for better fit */
        }

        .slide h7 {
            font-family: 'DM Sans', sans-serif;
            color: #3F665E;
            font-size: 1.5vw; /* Adjust font size for better scaling */
            line-height: 1.1;
            margin: 2vw; /* Reduced margin for better fit */
        }

        .slide p {
            color: #3F665E;
            font-size: 1.5vw; /* Adjust font size for better scaling */
            margin-top: 1.5vw; /* Reduced margin for better fit */
            margin-left: 3vw; /* Reduced margin for better fit */
            margin-right: 3vw; /* Reduced margin for better fit */
        }

        .slide p1 {
            color: #3F665E;
            font-size: 1vw; /* Adjust font size for better scaling */
            margin-top: 1vw; /* Reduced margin for better fit */
            font-weight: bold;
        }

        /* Adjusted image (intro-icon) */
        .intro-icon {
            width: 100%; /* Make the image responsive to container width */
            height: 100%; /* Make the height of the image fill the container */
            max-width: 100%; /* Prevent the image from overflowing horizontally */
            max-height: 80vh; /* Limit the height to 80% of the viewport height */
            object-fit: contain; /* Ensure the entire image fits without being cropped */
            margin: 0;
        }



        .icon-container {
            width: 120%;
            height: 90px; /* Adjust as needed for cropping */
            margin-top: 50px;
            display: flex;
            justify-content: left;
            align-items: center;
        }



        .artist-info {
            display: flex; /* Align items in a row */
            align-items: center; /* Center items vertically */
        }

        .artist-stats {
            margin-right: 20px; /* Space between text and stats */
            text-align: left; /* Center text and photo horizontally */
            display: flex;
            flex-direction: column; /* Stack name and photo vertically */
        }

        .artist-details {
            margin-right: 20px; /* Space between text and stats */
            text-align: center; /* Center text and photo horizontally */
            display: flex;
            flex-direction: column; /* Stack name and photo vertically */
        }

        .top-artist-photo {
            width: 150px; /* Adjust width as needed */
            height: auto; /* Maintain aspect ratio */
            margin-left: 70px;
        }


        .song-info {
            display: flex; /* Align items in a row */
            align-items: center; /* Center items vertically */
            width: 800px;
            margin-right: 30px;
        }

        .song-stats {
            text-align: left; /* Center text and photo horizontally */
            display: flex;
            flex-direction: column; /* Stack name and photo vertically */
            margin-right: 70px;
        }


        .song-details1 {
            align-items: center;
            display: flex;
            flex-direction: column; /* Stack name and photo vertically */
            justify-content: center; /* Center items vertically */
        }

        .top-song-photo {
            width: 150px; /* Adjust width as needed */
            height: auto; /* Maintain aspect ratio */
        }

        .vibes-details {
            margin-right: 20px; /* Space between text and stats */
            text-align: left; /* Center text and photo horizontally */
            display: flex;
            flex-direction: column; /* Stack name and photo vertically */
        }

        .other-icon-container {
            width: 100%;
            height: 90px; /* Adjust as needed for cropping */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .other-icon {
            width: auto; /* Adjust width/height as needed */
            height: 100px;
            object-fit: cover;
        }

        .play-pause-button {
            font-size: 16px; /* Default font size */
            padding: 10px 20px; /* Adjust button padding */
            width: auto; /* Make the button width adjust based on content */
            max-width: 100%; /* Ensure the button doesn't overflow its container */
            height: auto; /* Adjust the height to fit the content */
            box-sizing: border-box; /* Include padding in the width and height calculation */
            text-align: center; /* Center text within the button */
            border-radius: 5px; /* Rounded corners for the button */
            transition: background-color 0.3s ease, transform 0.2s ease; /* Add smooth transitions */
        }

        .play-pause-button:hover {
            background-color: #007bff; /* Change background color on hover */
            transform: scale(1.05); /* Slightly scale the button on hover */
        }

        /* Adjust button size for smaller screens */
        @media (max-width: 768px) {
            .play-pause-button {
                font-size: 14px; /* Smaller font size on smaller screens */
                padding: 8px 16px; /* Smaller padding for compact screens */
            }
        }

        /* Adjust for very small screens like mobile */
        @media (max-width: 480px) {
            .play-pause-button {
                font-size: 12px; /* Further reduce font size */
                padding: 6px 12px; /* Further reduce padding */
                width: 100%; /* Make the button take full width on very small screens */
            }
        }


        .artist-container {
            display: flex;
            justify-content: center; /* Center all artist items within the container */
            flex-wrap: nowrap; /* Prevent items from wrapping to the next line */
            margin-left: 30px;
            margin-right: 30px;
        }

        .artist {
            display: flex; /* Use flexbox to align items */
            flex-direction: column; /* Stack text and image vertically */
            align-items: center; /* Center items horizontally */
            margin: 5px; /* Adjust spacing between artists */
        }

        .artist-photo {
            width: 100%;
            height: auto;
            margin-top: 15px; /* Space between the image and the text */
            display: block; /* Ensure that the image is a block element */
            margin-left: auto; /* Center alignment */
            margin-right: auto; /* Center alignment */
        }


        .song-container {
            display: flex;
            justify-content: center; /* Center all artist items within the container */
            flex-wrap: nowrap; /* Prevent items from wrapping to the next line */
            margin-left: 30px;
            margin-right: 30px;
        }

        .song {
            display: flex; /* Use flexbox to align items */
            flex-direction: column; /* Stack text and image vertically */
            align-items: center; /* Center items horizontally */
            margin: 5px; /* Adjust spacing between artists */
        }

        .song-photo {
            width: 100%;
            height: auto;
            margin-top: 15px; /* Space between the image and the text */
            display: block; /* Ensure that the image is a block element */
            margin-left: auto; /* Center alignment */
            margin-right: auto; /* Center alignment */
        }


        .glance-info {
            display: flex; /* Align items in a row */
            align-items: center; /* Center items vertically */
            margin: 0;
        }

        .glance-details {
            margin-right: 10px; /* Space between text and stats */
            text-align: center; /* Center text and photo horizontally */
            display: flex;
            flex-direction: column; /* Stack name and photo vertically */
        }

        .slide.quiz {
            /*background: var(--primary-green);*/
        }

        .quiz-options p {
            font-size: 24px;
            transition: transform 0.05s ease-in-out; /* Smooth transition */
        }

        .quiz-options p:hover {
            transform: translate(10px, 0px);
            font-weight: bold;
        }

        .quiz-options p.selected {
            background-color: var(--primary-green-dark); /* Green */
            color: white;
            padding: 5px;
            border-radius: 5px;
        }

        body.dark-mode .quiz-options p.selected {
            background-color: #3F665E;
        }

        .quiz-options p.incorrect {
            background-color: #a2455e;
            color: white;
            padding: 5px;
            border-radius: 5px;
        }


        .adjustable-button {
            padding: 0.5em 1.5em; /* Reduced padding for a smaller height */
            background-color: #3F665E;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1vw; /* Responsive font size (relative to viewport width) */
            min-width: 50px; /* Minimum width for small screens */
            max-width: 200px; /* Maximum width to prevent it from getting too large */
            width: 50%; /* Button width adjusts based on container */
            height: auto; /* Adjust height automatically based on padding */
        }

        /* Optional: Add responsiveness for smaller screens */
        @media (max-width: 250px) {
            .adjustable-button {
                font-size: 5vw; /* Increase font size on smaller screens */
                padding: 0.8em 1.8em; /* Slightly reduced padding for better readability */
                width: 20%; /* Adjust width to fill more space on smaller screens */
                max-width: 50px;
            }
        }


        /* Dots and Arrow Button Styling */
        .dots-container {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .prev, .next {
            cursor: pointer;
            padding: 10px;
            color: #FFFFFF;
            font-weight: bold;
            font-size: 18px;
            user-select: none;
            border-radius: 50%;
            background-color: #3F665E !important;
            margin: 2vh 10px;
            text-decoration: none; /* Remove underline */
        }

        body.dark-mode .prev, .next {
            background-color: #576385;
        }
        .prev:hover, .next:hover {
            background-color: #1E1E1E;
        }
        .dots {
            display: flex;
            justify-content: center;
        }
        .dot {
            height: 12px;
            width: 12px;
            margin: 0 5px;
            background-color: white;
            border-radius: 50%;
            display: inline-block;
            cursor: pointer;
        }
        .dot.active {
            background-color: #3F665E;
        }

        /* Hover State for Log Out Button in Navbar for Dark Mode */
        body.dark-mode .navbar .btn:hover {
            background-color: #8692b5 !important; /* Slightly lighter blue for hover */
            color: #ffffff !important; /* Ensure text remains white */
        }

        body.dark-mode .main-content {
            background-color: var(--dark-background);
            box-shadow: none;
        }

        /* Optional: Add hover effects */
        body.dark-mode .btn-secondary:hover,
        body.dark-mode .btn-primary:hover,
        body.dark-mode .btn-danger:hover {
            opacity: 0.9; /* Slight dimming on hover */
            background-color: #232f3c !important;
        }

        body.dark-mode .slide, .slide quiz, .slide active {
            background-color: var(--background-dark-grey);
        }

        body.dark-mode .dot.active {
            background-color: white;
        }
        body.dark-mode .dot {
            background-color: #8692b5;
        }


        .song-stats {
            font-family: 'DM Sans', sans-serif;
            color: #3F665E;
            margin-bottom: 10px;
        }

        .popularity-bar-container {
            width: 100%; /* Full width of the container */
            height: 1vh; /* Height of the bar */
            background-color: #A5CBC3; /* Light gray background */
            border-radius: 5px; /* Rounded corners */
            margin-top: 5px; /* Space above the bar */
        }

        .popularity-bar {
            height: 100%; /* Full height of the container */
            background-color: #3F665E; /* Color of the bar */
            border-radius: 5px; /* Rounded corners */
            transition: width 0.5s ease; /* Smooth transition for width change */
        }

        .chart-wrapper {
            display: flex;
            align-items: center;
            height: 40vh;
            margin: 0;
            gap: min(1vw, 30px);
        }

        .chart-container {
            width: 50vh;
            max-width: 70%;
            height: 100%;
            margin-left: 15%;
            position: relative;
        }

        #genrePieChart {
            width: 100%;
            height: 100%;
            border-radius: 50%; /* Keep the chart circular */
            display: block;
        }

        .chart-key {
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-family: 'DM Sans', sans-serif;
            color: #3F665E;
            font-size: 1.3vw;
            line-height: 1.1;
            margin-top: 2vw;
            margin-right: 3vw;
            font-weight: bold;
            min-width: 350px; /* Ensure a minimum width for the key area */
        }

        .chart-key div {
            margin-bottom: 1vw;
            text-transform: capitalize;
        }


        .vibes-details {
            margin: 2vh 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px; /* Height of the progress bar */
            background-color: #A5CBC3; /* Light background for the bar */
            border-radius: 10px; /* Rounded corners */
            margin-top: 5px;
            margin-left: 5vh;
        }

        .progress {
            height: 100%;
            border-radius: 10px; /* Rounded corners for the filled part */
            background-color: #3F665E; /* Color of the filled part */
            text-align: left;
            line-height: 20px; /* Align text vertically inside the bar */
            color: white;
            font-weight: bold;
        }

        h4 {
            margin-bottom: 5px;
        }


        body.dark-mode .chart-key {
            color: #E5E5E5; /* Dark mode text color */
        }


        /* Slide In & Out Animation */
        @keyframes slide-out-left {
            0% {
                transform: translate(0, 0) scale(1);
                z-index: 2;
            }
            49% {
                z-index: 2; /* Outgoing slide stays on top until halfway */
            }
            50% {
                transform: translate(-400px, 0) scale(0.9);
                z-index: 1;
            }
            100% {
                transform: translate(0, 0) scale(0.8);
                z-index: 1;
                opacity: 0;
            }
        }
        @keyframes slide-in-right {
            0% {
                transform: translate(0, 0) scale(0.8);
                z-index: 1;
            }
            49% {
                z-index: 1; /* Incoming slide below outgoing slide initially */
            }
            50% {
                transform: translate(400px, 0) scale(0.9);
                z-index: 2;
            }
            100% {
                transform: translate(0, 0) scale(1);
                z-index: 2;
            }
        }
        @keyframes slide-out-right {
            0% {
                transform: translate(0, 0) scale(1);
                z-index: 2;
            }
            49% {
                z-index: 2;
            }
            50% {
                transform: translate(400px, 0) scale(0.9);
                z-index: 1;
            }
            100% {
                transform: translate(0, 0) scale(0.8);
                z-index: 1;
                opacity: 0;
            }
        }
        @keyframes slide-in-left {
            0% {
                transform: translate(0, 0) scale(0.8);
                z-index: 1;
            }
            49% {
                z-index: 1;
            }
            50% {
                transform: translate(-400px, 0) scale(0.9);
                z-index: 2;
            }
            100% {
                transform: translate(0, 0) scale(1);
                z-index: 2;
            }
        }
        .outgoing-left {
            animation: slide-out-left 1.5s ease-in-out forwards;
        }

        .incoming-right {
            animation: slide-in-right 1.5s ease-in-out forwards;
        }

        .outgoing-right {
            animation: slide-out-right 1.5s ease-in-out forwards;
        }

        .incoming-left {
            animation: slide-in-left 1.5s ease-in-out forwards;
        }
    </style>
</head>
<body>
    <!-- Header and Navbar -->
    <header>
        <nav class="navbar">
            <a href="{% url 'dashboard' %}">Dashboard</a>
            <a href="{% url 'account_settings' %}">Account</a>
            <a href="#" class="btn" data-bs-toggle="modal" data-bs-target="#logoutModal">Log Out</a>
        </nav>
    </header>

    <!-- Main Content Area for Centered Slideshow -->
    <div class="main-content">
        <div id="slideshow-container" class="slideshow-container">

            <!-- Slide 1 -->
            <div class="slide active">
                <h2>{{user_name}}, are you ready to explore your musical soul?</h2>
                <p class="intro-text">Your musical journey awaits—discover your top tracks, artists, and genres.</p>
                <div class="icon-container">
                    <img src="{% static 'sound-icon.png' %}" alt="sound waves" class="intro-icon">
                </div>
            </div>

            <!-- Quiz Q1 -->
            <div class="slide quiz">
                <h2>Pop Quiz!</h2>
                <h3>Who's your top artist?</h3>
                <div class="quiz-options">
                    <p class="quiz-options" data-correct="false">a) {{ top_five_artists.4.name }}</p>
                    <p class="quiz-options" data-correct="true">b) {{ top_five_artists.0.name }}</p>
                    <p class="quiz-options" data-correct="false">c) {{ top_five_artists.1.name }}</p>
                    <p class="quiz-options" data-correct="false">d) {{ top_five_artists.2.name }}</p>
                </div>
            </div>

            <!-- Slide 2 -->
            <div class="slide">
                <h2>Your top artist is...</h2>
                <div class="artist-info">
                    <div class="artist-details">
                        <h3>{{ top_five_artists.0.name }}</h3>
                        <img src="{{ top_five_artists.0.image_url }}" alt="top artist image" class="top-artist-photo">
                    </div>
                    <div class="artist-stats">
                        <h4>Genre: {{ top_five_artists.0.genres|join:", " }}</h4> <!-- the join gets rid of the [' '] -->
                        <h4>Popularity: </h4>
                        <div class="popularity-bar-container" style="margin-left: 10%; max-width: 70%; margin-top: 1vh">
                            <div class="popularity-bar" style="width: {{ top_five_songs.0.popularity }}%"></div>
                        </div>
<!--                        <h4>Top Songs: </h4>-->
                    </div>
                </div>
            </div>

            <!-- Slide 3 -->
            <div class="slide">
                <h2>Your top 5 artists are...</h2>
                <div class="artist-container">
                    {% for artist in top_five_artists %}
                        <div class="artist">
                            <p1>#{{ forloop.counter }}. {{ artist.name }}</p1>
                            <img src="{{ artist.image_url }}" alt="artist image" class="artist-photo">
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Quiz Q2 -->
            <div class="slide quiz">
                <h2>Pop Quiz!</h2>
                <h3>Which is your top song?</h3>
                <div class="quiz-options">
                    <p class="quiz-options" data-correct="false">a) {{ top_five_songs.4.name }}</p>
                    <p class="quiz-options" data-correct="true">b) {{ top_five_songs.0.name }}</p>
                    <p class="quiz-options" data-correct="false">c) {{ top_five_songs.1.name }}</p>
                    <p class="quiz-options" data-correct="false">d) {{ top_five_songs.2.name }}</p>
                </div>
            </div>

            <!-- Slide 4 -->
            <div class="slide">
                <h2>Your top song is...</h2>
                <div class="song-info">
                    <div class="song-details1" style="display: flex; flex-direction: column; align-items: center;">
                        <h6>{{ top_five_songs.0.name }}</h6>
                        <img src="{{ top_five_songs.0.image_url }}" alt="top song image" class="top-song-photo">
                        {% if top_five_songs.0.preview_url %}
                            <audio id="audio-top-song">
                                <source src="{{ top_five_songs.0.preview_url }}" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                            <!-- Play/pause btn -->
                            <button class="play-pause-button btn btn-primary mt-2" data-audio-id="audio-top-song">
                                ▶
                            </button>
                        {% else %}
                            <p class="text-muted">No preview available</p>
                        {% endif %}
                        <div class="other-icon-container">
<!--                            <img src="{% static 'playback icon.png' %}" alt="playback" class="other-icon">-->
                        </div>
                    </div>
                    <div class="song-stats">
                        <h5>Popularity: %</h5>
                        <div class="popularity-bar-container">
                            <div class="popularity-bar" style="width: {{ top_five_songs.0.popularity }}%"></div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Slide 5 -->
            <div class="slide">
                <h2>Your top 5 songs are...</h2>
                <div class="song-container">
                    {% for song in top_five_songs %}
                        <div class="song">
                            <p1>#{{ forloop.counter }}. {{ song.name }}</p1>
                            <img src="{{ song.image_url }}" alt="song image" class="song-photo">
                            {% if song.preview_url %}
                                <!-- Hidden Audio Element -->
                                <audio id="audio-{{ forloop.counter }}">
                                    <source src="{{ song.preview_url }}" type="audio/mpeg">
                                    Your browser does not support the audio element.
                                </audio>
                                <!-- Play/Pause Button -->
                                <button class="play-pause-button btn btn-primary mt-2" data-audio-id="audio-{{ forloop.counter }}">
                                    Play
                                </button>
                            {% else %}
                                <p class="text-muted">No preview available</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Slide 6 -->
            <div class="slide">
                <h2>Your top 5 genres are...</h2>
                <div class="chart-wrapper">
                    <div class="chart-container">
                        <canvas id="genrePieChart"></canvas>
                    </div>
                    <div class="chart-key" id="chartKey"></div>
                </div>
            </div>


            <!-- Slide 7 -->
            <div class="slide">
                <h2>Your vibe data...</h2>
                <div class="artist-info">
                    <div class="vibes-details">
                        <h4>Danceability: {{ vibe_data.average_danceability|floatformat:2 }}%</h4>
                        <div class="progress-bar">
                            <div class="progress" style="width: {{ vibe_data.average_danceability }}%"></div>
                        </div>

                        <h4>Valence: {{ vibe_data.average_valence|floatformat:2 }}%</h4>
                        <div class="progress-bar">
                            <div class="progress" style="width: {{ vibe_data.average_valence }}%"></div>
                        </div>

                        <h4>Energy: {{ vibe_data.average_energy|floatformat:2 }}%</h4>
                        <div class="progress-bar">
                            <div class="progress" style="width: {{ vibe_data.average_energy }}%"></div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Slide 8 -->
            <div class="slide">
                <h3>Your Musical Soul at a Glance...</h3>
                <div class="glance-info">
                    <div class="glance-details">
                        <h7>Top Artist: {{top_five_artists.0.name}} </h7>
                        <img src="{{ top_five_artists.0.image_url }}" alt="top artist image" class="artist-photo">
                    </div>
                    <div class="glance-details">
                        <h7>Top Song: {{top_five_songs.0.name}} </h7>
                        <img src="{{ top_five_artists.1.image_url }}" alt="top artist image" class="artist-photo">
                    </div>
                    <div class="glance-details">
                        <h7>Top Genre: {{top_1_genre}} </h7>
                        <img src="{{ top_five_artists.2.image_url }}" alt="top artist image" class="artist-photo">
                    </div>
                </div>
                <div style="text-align: center; margin-top: 50px;">
                    {% if is_saved %}
                        <div style="text-align: center; margin-top: 50px;">
                        <form method="post" action="{% url 'history' %}">
                            {% csrf_token %}
                            <button type="submit" style="padding: 10px 20px; background-color: #3F665E; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                Return to History
                            </button>
                        </form>
                        </div>
                    {% else %}
                        <form method="post" action="{% url 'save_spotify_profile' %}">
                        {% csrf_token %}
                        <input type="hidden" name="temporary_profile_id" value="{{ temp_profile_id }}">
                        <button type="submit" class="adjustable-button">
                            Save this Profile
                        </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="dots-container">
            <a class="prev" onclick="changeSlide(-1)">&#10094;</a>
            <div class="dots">
                <span class="dot active" onclick="currentSlide(0)"></span>
                <span class="dot" onclick="currentSlide(1)"></span>
                <span class="dot" onclick="currentSlide(2)"></span>
                <span class="dot" onclick="currentSlide(3)"></span>
                <span class="dot" onclick="currentSlide(4)"></span>
                <span class="dot" onclick="currentSlide(5)"></span>
                <span class="dot" onclick="currentSlide(6)"></span>
                <span class="dot" onclick="currentSlide(7)"></span>
                <span class="dot" onclick="currentSlide(8)"></span>
                <span class="dot" onclick="currentSlide(9)"></span>
            </div>
            <a class="next" onclick="changeSlide(1)">&#10095;</a>
        </div>
    </div>

    <script>
        let slideIndex = 0; // curr index
        const slides = document.querySelectorAll('.slide');
        const dots = document.querySelectorAll('.dot');
        const animationDuration = 1500; // Duration in ms matching CSS animation

        /**
         * This function finds and displays in the new slide
         * @param newIndex The new index of the slide we are displaying
         * @param direction Either next or before, depending on which arrow was clicked
         */
        function showSlide(newIndex, direction) {
            const outgoingSlide = slides[slideIndex];
            const incomingSlide = slides[newIndex];

            // Reset all slides to remove animations and hide them initially
            slides.forEach(slide => {
                slide.classList.remove('active', 'outgoing-left', 'incoming-right', 'outgoing-right', 'incoming-left');
                slide.style.display = 'none';
            });

            // Ensure the outgoing slide is visible before animating out
            outgoingSlide.style.display = 'block';
            outgoingSlide.style.zIndex = 2; // Set outgoing slide behind incoming

            // Apply the correct animation classes based on direction
            if (direction === 'next') {
                outgoingSlide.classList.add('outgoing-left');
                incomingSlide.classList.add('incoming-right');
            } else {
                outgoingSlide.classList.add('outgoing-right');
                incomingSlide.classList.add('incoming-left');
            }

            // Ensure the incoming slide is above the outgoing slide and visible
            incomingSlide.style.display = 'block';
            incomingSlide.style.zIndex = 1;
            incomingSlide.classList.add('active');

            // Update dot navigation
            dots.forEach(dot => dot.classList.remove('active'));
            dots[newIndex].classList.add('active');

            // Hide the outgoing slide after the animation completes
            setTimeout(() => {
                // outgoingSlide.style.display = 'none'; // Hide the outgoing slide
                slideIndex = newIndex; // Update slideIndex after the transition completes
            }, animationDuration);
        }

        /**
         * This function changes the slide given an amount to move
         * @param n The amount we want to move
         */
        function changeSlide(n) {
            const newSlideIndex = (slideIndex + n + slides.length) % slides.length;
            const direction = n > 0 ? 'next' : 'prev';
            showSlide(newSlideIndex, direction);
        }

        /**
         * This function displays the current slide
         * @param index The index of the current slide
         */
        function currentSlide(index) {
            const direction = index > slideIndex ? 'next' : 'prev';
            showSlide(index, direction);
        }

        // Initial display
        showSlide(slideIndex, 'next');

        document.addEventListener('DOMContentLoaded', function () {
            const slideshowContainer = document.getElementById('slideshow-container');
            const quizOptions = document.querySelectorAll('.quiz-options p');

            /**
             * This function updates the link to not work if not on wrapped summary
             */
            function updateLink() {
                const activeSlide = document.querySelector('.slide.active');
                if (activeSlide && activeSlide.querySelector('h2').innerText === 'Wrapped Summary') {
                    slideshowContainer.onclick = () => {
                        window.location.href = "{% url 'spotify_login' %}";
                    };
                } else {
                    slideshowContainer.onclick = null; // Remove click event if not on "Wrapped Summary"
                }
            }

            /**
             * Handles the quiz option click.
             * @param event The click of the user
             */
            function handleQuizOptionClick(event) {
                const selectedOption = event.target;

                // Disable further clicks on all options
                // const allOptions = selectedOption.parentNode.querySelectorAll('p');
                // allOptions.forEach(option => option.style.pointerEvents = 'none');


                if (selectedOption.dataset.correct === 'true') {
                    // Highlight the correct answer
                    selectedOption.classList.add('selected');
                    /*setTimeout(() => {
                        // Transition to the next slide
                        changeSlide(1); // Move to the next slide
                    }, 500); // Wait for feedback before sliding*/
                } else {
                    // Highlight incorrect answer
                    selectedOption.classList.add('incorrect');
                }
            }
            /**
             * Adds event listeners to quiz options.
             */
            quizOptions.forEach(option => {
                option.addEventListener('click', handleQuizOptionClick);
            });



            // Set up a MutationObserver to detect class changes in slides
            const observer = new MutationObserver(updateLink);
            slides.forEach(slide => observer.observe(slide, { attributes: true, attributeFilter: ['class'] }));

            // Initial link setup
            updateLink();
        });
    </script>

<!-- Log Out Confirmation Modal -->
<div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h5 class="modal-title" id="logoutModalLabel">Confirm Log Out</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
                Are you sure you want to log out?
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="{% url 'signout' %}" class="btn btn-primary">Log Out</a>
            </div>
        </div>
    </div>
</div>

<!-- jQuery (Optional for Bootstrap 5, but required if you use any jQuery plugins) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap JavaScript Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script src="{% static 'darkmode.js' %}"></script>
<script src="{% static 'summary.js' %}"></script>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const topGenres = JSON.parse('{{ top_genres|safe|escapejs }}');

        if (!topGenres || Object.keys(topGenres).length === 0) {
            console.error("Top genres data is missing or empty.");
            return;
        }

        const labels = Object.keys(topGenres);
        const data = Object.values(topGenres);

        const total = data.reduce((sum, value) => sum + value, 0);
        const percentages = data.map(value => ((value / total) * 100).toFixed(1));

        const sortedGenres = labels.map((label, index) => ({
            label,
            percentage: percentages[index]
        })).sort((a, b) => b.percentage - a.percentage);

        const sortedLabels = sortedGenres.map(item => item.label);
        const sortedPercentages = sortedGenres.map(item => item.percentage);

        const mutedColors = [
            '#A6CEE3', '#B2DF8A', '#FB9A99', '#FDBF6F', '#CAB2D6',
            '#FFFF99', '#1F78B4', '#33A02C', '#E31A1C', '#FF7F00'
        ];

        const ctx = document.getElementById('genrePieChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: sortedLabels,
                datasets: [{
                    data: sortedPercentages,
                    backgroundColor: mutedColors.slice(0, sortedPercentages.length),
                    borderColor: '#ffffff',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function (context) {
                                const index = context.dataIndex;
                                return `${sortedLabels[index]}: ${sortedPercentages[index]}%`;
                            }
                        }
                    }
                }
            }
        });

        const chartKey = document.getElementById('chartKey');

        // Helper function to capitalize the first letter of each word
        const capitalizeWords = (text) => text.replace(/\b\w/g, char => char.toUpperCase());

        sortedGenres.slice(0, 5).forEach((item, index) => {
            const keyItem = document.createElement('div');
            keyItem.innerHTML = `<strong>${index + 1}.</strong> ${capitalizeWords(item.label)}: ${item.percentage}%`;

            // Apply the corresponding color to each key item
            keyItem.style.color = mutedColors[index];

            chartKey.appendChild(keyItem);
        });
    });


</script>




</body>
</html>